// ============================================================================
// TRANSLATIONS
// ============================================================================

const translations = {
    it: {
        // Sidebar
        appTitle: "Cost Accounting",
        appSubtitle: "Strumenti Professionali",
        reciprocalMethod: "Metodo Reciproco",
        wipValuation: "Valutazione WIP",
        
        // Reciprocal Method
        reciprocalTitle: "Metodo Reciproco",
        reciprocalSubtitle: "Risoluzione di esercizi con Equazioni Simultanee",
        step1Title: "Definisci i Dipartimenti",
        step2Title: "Inserisci i Costi Primari",
        step3Title: "Inserisci le UnitÃ  di Servizio Rese",
        step4Title: "Basi di Allocazione (Opzionale)",
        step4Subtitle: "Inserisci le basi (es. w.u, machine hours) per calcolare i cost rates",
        supportDepts: "Dipartimenti di Supporto",
        productionDepts: "Dipartimenti di Produzione",
        addSupport: "+ Aggiungi Support",
        addProduction: "+ Aggiungi Production",
        confirmDepts: "Conferma Dipartimenti â†’",
        confirmCosts: "Conferma Costi â†’",
        confirmUnits: "Conferma UnitÃ  â†’",
        calculateResults: "ðŸ§® Calcola Risultati",
        results: "Risultati",
        directCost: "Costo diretto",
        totalUnits: "Totale unitÃ ",
        costRate: "Cost rate",
        allocated: "Allocato",
        allocationDetails: "Dettaglio Allocazioni",
        total: "TOTALE",
        totalGeneral: "TOTALE GENERALE",
        
        // WIP
        wipTitle: "Valutazione WIP",
        wipSubtitle: "Calcolo della valutazione del Work in Process",
        baseConfig: "Configurazione Base",
        valuationMethod: "Metodo di Valutazione",
        deptName: "Nome Dipartimento",
        periodCosts: "Costi del Periodo",
        materials: "Materials",
        conversionCosts: "Indirect Conversion Costs",
        openingWIP: "Opening Work in Process",
        unitsInWIP: "UnitÃ  in WIP Iniziale",
        completionPercent: "Completion % (CC%)",
        materialsCostWIP: "Costo Materials WIP",
        conversionCostWIP: "Costo Conversion WIP",
        periodMovements: "Movimenti del Periodo",
        unitsStarted: "UnitÃ  Started",
        unitsCompleted: "UnitÃ  Completed",
        endingWIPCC: "Ending WIP CC%",
        calculateWIP: "ðŸ§® Calcola WIP Valuation",
        wipResults: "Risultati WIP",
        physicalFlow: "Physical Flow",
        openingWIPLabel: "Opening WIP",
        started: "Started",
        completed: "Completed",
        startedCompleted: "Started & Completed",
        endingWIP: "Ending WIP",
        equivalentUnits: "Equivalent Units",
        costPerEU: "Cost per Equivalent Unit",
        completingOpeningWIP: "Completing Opening WIP",
        openingDM: "Opening DM",
        openingCC: "Opening CC",
        additionalCC: "Additional CC to complete",
        totalOpeningWIP: "Total Opening WIP",
        startedAndCompleted: "Started and Completed",
        totalStartedCompleted: "Total Started & Completed",
        endingWIPSection: "Ending WIP",
        totalEndingWIP: "Total Ending WIP",
        finishedGoods: "FINISHED GOODS",
        units: "units",
        unit: "unit",
        
        // Break-Even
        breakEvenAnalysis: "Break-Even Analysis",
        breakEvenTitle: "Break-Even Analysis",
        breakEvenSubtitle: "Analisi del punto di pareggio e margine di contribuzione",
        productInfo: "Informazioni Prodotto",
        productName: "Nome Prodotto",
        sellingPrice: "Prezzo di Vendita",
        variableCosts: "Costi Variabili",
        variableCostPerUnit: "Costo Variabile per UnitÃ ",
        variableCostBreakdown: "Dettaglio (opzionale)",
        fixedCosts: "Costi Fissi",
        totalFixedCosts: "Costi Fissi Totali",
        fixedCostBreakdown: "Dettaglio (opzionale)",
        targetAnalysis: "Analisi Target (Opzionale)",
        targetProfit: "Profitto Target",
        expectedSales: "Vendite Previste",
        calculateBreakEven: "ðŸ§® Calcola Break-Even",
        contributionMargin: "Margine di Contribuzione",
        contributionMarginRatio: "Rapporto Margine di Contribuzione",
        breakEvenUnits: "Break-Even Point (UnitÃ )",
        breakEvenRevenue: "Break-Even Point (Fatturato)",
        unitsForTarget: "UnitÃ  per Profitto Target",
        marginOfSafety: "Margine di Sicurezza",
        marginOfSafetyPercent: "Margine di Sicurezza %",
        operatingLeverage: "Leva Operativa"
    },
    
    en: {
        // Sidebar
        appTitle: "Cost Accounting",
        appSubtitle: "Professional Tools",
        reciprocalMethod: "Reciprocal Method",
        wipValuation: "WIP Valuation",
        
        // Reciprocal Method
        reciprocalTitle: "Reciprocal Method",
        reciprocalSubtitle: "Solving exercises with Simultaneous Equations",
        step1Title: "Define Departments",
        step2Title: "Enter Primary Costs",
        step3Title: "Enter Service Units Rendered",
        step4Title: "Allocation Bases (Optional)",
        step4Subtitle: "Enter bases (e.g. w.u, machine hours) to calculate cost rates",
        supportDepts: "Support Departments",
        productionDepts: "Production Departments",
        addSupport: "+ Add Support",
        addProduction: "+ Add Production",
        confirmDepts: "Confirm Departments â†’",
        confirmCosts: "Confirm Costs â†’",
        confirmUnits: "Confirm Units â†’",
        calculateResults: "ðŸ§® Calculate Results",
        results: "Results",
        directCost: "Direct cost",
        totalUnits: "Total units",
        costRate: "Cost rate",
        allocated: "Allocated",
        allocationDetails: "Allocation Details",
        total: "TOTAL",
        totalGeneral: "TOTAL GENERAL",
        
        // WIP
        wipTitle: "WIP Valuation",
        wipSubtitle: "Work in Process valuation calculation",
        baseConfig: "Base Configuration",
        valuationMethod: "Valuation Method",
        deptName: "Department Name",
        periodCosts: "Period Costs",
        materials: "Materials",
        conversionCosts: "Indirect Conversion Costs",
        openingWIP: "Opening Work in Process",
        unitsInWIP: "Units in Opening WIP",
        completionPercent: "Completion % (CC%)",
        materialsCostWIP: "Materials Cost WIP",
        conversionCostWIP: "Conversion Cost WIP",
        periodMovements: "Period Movements",
        unitsStarted: "Units Started",
        unitsCompleted: "Units Completed",
        endingWIPCC: "Ending WIP CC%",
        calculateWIP: "ðŸ§® Calculate WIP Valuation",
        wipResults: "WIP Results",
        physicalFlow: "Physical Flow",
        openingWIPLabel: "Opening WIP",
        started: "Started",
        completed: "Completed",
        startedCompleted: "Started & Completed",
        endingWIP: "Ending WIP",
        equivalentUnits: "Equivalent Units",
        costPerEU: "Cost per Equivalent Unit",
        completingOpeningWIP: "Completing Opening WIP",
        openingDM: "Opening DM",
        openingCC: "Opening CC",
        additionalCC: "Additional CC to complete",
        totalOpeningWIP: "Total Opening WIP",
        startedAndCompleted: "Started and Completed",
        totalStartedCompleted: "Total Started & Completed",
        endingWIPSection: "Ending WIP",
        totalEndingWIP: "Total Ending WIP",
        finishedGoods: "FINISHED GOODS",
        units: "units",
        unit: "unit",
        
        // Break-Even
        breakEvenAnalysis: "Break-Even Analysis",
        breakEvenTitle: "Break-Even Analysis",
        breakEvenSubtitle: "Break-even point and contribution margin analysis",
        productInfo: "Product Information",
        productName: "Product Name",
        sellingPrice: "Selling Price",
        variableCosts: "Variable Costs",
        variableCostPerUnit: "Variable Cost per Unit",
        variableCostBreakdown: "Breakdown (optional)",
        fixedCosts: "Fixed Costs",
        totalFixedCosts: "Total Fixed Costs",
        fixedCostBreakdown: "Breakdown (optional)",
        targetAnalysis: "Target Analysis (Optional)",
        targetProfit: "Target Profit",
        expectedSales: "Expected Sales",
        calculateBreakEven: "ðŸ§® Calculate Break-Even",
        contributionMargin: "Contribution Margin",
        contributionMarginRatio: "Contribution Margin Ratio",
        breakEvenUnits: "Break-Even Point (Units)",
        breakEvenRevenue: "Break-Even Point (Revenue)",
        unitsForTarget: "Units for Target Profit",
        marginOfSafety: "Margin of Safety",
        marginOfSafetyPercent: "Margin of Safety %",
        operatingLeverage: "Operating Leverage"
    },
    
    fr: {
        // Sidebar
        appTitle: "ComptabilitÃ© Analytique",
        appSubtitle: "Outils Professionnels",
        reciprocalMethod: "MÃ©thode RÃ©ciproque",
        wipValuation: "Ã‰valuation WIP",
        
        // Reciprocal Method
        reciprocalTitle: "MÃ©thode RÃ©ciproque",
        reciprocalSubtitle: "RÃ©solution d'exercices avec Ã‰quations SimultanÃ©es",
        step1Title: "DÃ©finir les DÃ©partements",
        step2Title: "Entrer les CoÃ»ts Primaires",
        step3Title: "Entrer les UnitÃ©s de Service Rendues",
        step4Title: "Bases d'Allocation (Optionnel)",
        step4Subtitle: "Entrez les bases (ex. u.o, heures machine) pour calculer les taux de coÃ»t",
        supportDepts: "DÃ©partements de Support",
        productionDepts: "DÃ©partements de Production",
        addSupport: "+ Ajouter Support",
        addProduction: "+ Ajouter Production",
        confirmDepts: "Confirmer DÃ©partements â†’",
        confirmCosts: "Confirmer CoÃ»ts â†’",
        confirmUnits: "Confirmer UnitÃ©s â†’",
        calculateResults: "ðŸ§® Calculer RÃ©sultats",
        results: "RÃ©sultats",
        directCost: "CoÃ»t direct",
        totalUnits: "Total unitÃ©s",
        costRate: "Taux de coÃ»t",
        allocated: "AllouÃ©",
        allocationDetails: "DÃ©tails d'Allocation",
        total: "TOTAL",
        totalGeneral: "TOTAL GÃ‰NÃ‰RAL",
        
        // WIP
        wipTitle: "Ã‰valuation WIP",
        wipSubtitle: "Calcul de l'Ã©valuation du Work in Process",
        baseConfig: "Configuration de Base",
        valuationMethod: "MÃ©thode d'Ã‰valuation",
        deptName: "Nom du DÃ©partement",
        periodCosts: "CoÃ»ts de la PÃ©riode",
        materials: "MatÃ©riaux",
        conversionCosts: "CoÃ»ts de Conversion Indirects",
        openingWIP: "WIP d'Ouverture",
        unitsInWIP: "UnitÃ©s en WIP Initial",
        completionPercent: "% d'AchÃ¨vement (CC%)",
        materialsCostWIP: "CoÃ»t MatÃ©riaux WIP",
        conversionCostWIP: "CoÃ»t Conversion WIP",
        periodMovements: "Mouvements de la PÃ©riode",
        unitsStarted: "UnitÃ©s DÃ©marrÃ©es",
        unitsCompleted: "UnitÃ©s TerminÃ©es",
        endingWIPCC: "CC% WIP Final",
        calculateWIP: "ðŸ§® Calculer Ã‰valuation WIP",
        wipResults: "RÃ©sultats WIP",
        physicalFlow: "Flux Physique",
        openingWIPLabel: "WIP d'Ouverture",
        started: "DÃ©marrÃ©es",
        completed: "TerminÃ©es",
        startedCompleted: "DÃ©marrÃ©es & TerminÃ©es",
        endingWIP: "WIP Final",
        equivalentUnits: "UnitÃ©s Ã‰quivalentes",
        costPerEU: "CoÃ»t par UnitÃ© Ã‰quivalente",
        completingOpeningWIP: "AchÃ¨vement WIP d'Ouverture",
        openingDM: "DM d'Ouverture",
        openingCC: "CC d'Ouverture",
        additionalCC: "CC Additionnel pour terminer",
        totalOpeningWIP: "Total WIP d'Ouverture",
        startedAndCompleted: "DÃ©marrÃ©es et TerminÃ©es",
        totalStartedCompleted: "Total DÃ©marrÃ©es & TerminÃ©es",
        endingWIPSection: "WIP Final",
        totalEndingWIP: "Total WIP Final",
        finishedGoods: "PRODUITS FINIS",
        units: "unitÃ©s",
        unit: "unitÃ©"
    },
    
    es: {
        // Sidebar
        appTitle: "Contabilidad de Costos",
        appSubtitle: "Herramientas Profesionales",
        reciprocalMethod: "MÃ©todo RecÃ­proco",
        wipValuation: "ValoraciÃ³n WIP",
        
        // Reciprocal Method
        reciprocalTitle: "MÃ©todo RecÃ­proco",
        reciprocalSubtitle: "ResoluciÃ³n de ejercicios con Ecuaciones SimultÃ¡neas",
        step1Title: "Definir Departamentos",
        step2Title: "Introducir Costos Primarios",
        step3Title: "Introducir Unidades de Servicio Prestadas",
        step4Title: "Bases de AsignaciÃ³n (Opcional)",
        step4Subtitle: "Introduce las bases (ej. u.o, horas mÃ¡quina) para calcular las tasas de costo",
        supportDepts: "Departamentos de Soporte",
        productionDepts: "Departamentos de ProducciÃ³n",
        addSupport: "+ AÃ±adir Soporte",
        addProduction: "+ AÃ±adir ProducciÃ³n",
        confirmDepts: "Confirmar Departamentos â†’",
        confirmCosts: "Confirmar Costos â†’",
        confirmUnits: "Confirmar Unidades â†’",
        calculateResults: "ðŸ§® Calcular Resultados",
        results: "Resultados",
        directCost: "Costo directo",
        totalUnits: "Total unidades",
        costRate: "Tasa de costo",
        allocated: "Asignado",
        allocationDetails: "Detalles de AsignaciÃ³n",
        total: "TOTAL",
        totalGeneral: "TOTAL GENERAL",
        
        // WIP
        wipTitle: "ValoraciÃ³n WIP",
        wipSubtitle: "CÃ¡lculo de la valoraciÃ³n del Work in Process",
        baseConfig: "ConfiguraciÃ³n Base",
        valuationMethod: "MÃ©todo de ValoraciÃ³n",
        deptName: "Nombre del Departamento",
        periodCosts: "Costos del PerÃ­odo",
        materials: "Materiales",
        conversionCosts: "Costos de ConversiÃ³n Indirectos",
        openingWIP: "WIP de Apertura",
        unitsInWIP: "Unidades en WIP Inicial",
        completionPercent: "% de FinalizaciÃ³n (CC%)",
        materialsCostWIP: "Costo Materiales WIP",
        conversionCostWIP: "Costo ConversiÃ³n WIP",
        periodMovements: "Movimientos del PerÃ­odo",
        unitsStarted: "Unidades Iniciadas",
        unitsCompleted: "Unidades Completadas",
        endingWIPCC: "CC% WIP Final",
        calculateWIP: "ðŸ§® Calcular ValoraciÃ³n WIP",
        wipResults: "Resultados WIP",
        physicalFlow: "Flujo FÃ­sico",
        openingWIPLabel: "WIP de Apertura",
        started: "Iniciadas",
        completed: "Completadas",
        startedCompleted: "Iniciadas & Completadas",
        endingWIP: "WIP Final",
        equivalentUnits: "Unidades Equivalentes",
        costPerEU: "Costo por Unidad Equivalente",
        completingOpeningWIP: "Completando WIP de Apertura",
        openingDM: "DM de Apertura",
        openingCC: "CC de Apertura",
        additionalCC: "CC Adicional para completar",
        totalOpeningWIP: "Total WIP de Apertura",
        startedAndCompleted: "Iniciadas y Completadas",
        totalStartedCompleted: "Total Iniciadas & Completadas",
        endingWIPSection: "WIP Final",
        totalEndingWIP: "Total WIP Final",
        finishedGoods: "PRODUCTOS TERMINADOS",
        units: "unidades",
        unit: "unidad"
    },
    
    ca: {
        // Sidebar
        appTitle: "Comptabilitat de Costos",
        appSubtitle: "Eines Professionals",
        reciprocalMethod: "MÃ¨tode RecÃ­proc",
        wipValuation: "ValoraciÃ³ WIP",
        
        // Reciprocal Method
        reciprocalTitle: "MÃ¨tode RecÃ­proc",
        reciprocalSubtitle: "ResoluciÃ³ d'exercicis amb Equacions SimultÃ nies",
        step1Title: "Definir Departaments",
        step2Title: "Introduir Costos Primaris",
        step3Title: "Introduir Unitats de Servei Prestades",
        step4Title: "Bases d'AssignaciÃ³ (Opcional)",
        step4Subtitle: "Introdueix les bases (ex. u.o, hores mÃ quina) per calcular les taxes de cost",
        supportDepts: "Departaments de Suport",
        productionDepts: "Departaments de ProducciÃ³",
        addSupport: "+ Afegir Suport",
        addProduction: "+ Afegir ProducciÃ³",
        confirmDepts: "Confirmar Departaments â†’",
        confirmCosts: "Confirmar Costos â†’",
        confirmUnits: "Confirmar Unitats â†’",
        calculateResults: "ðŸ§® Calcular Resultats",
        results: "Resultats",
        directCost: "Cost directe",
        totalUnits: "Total unitats",
        costRate: "Taxa de cost",
        allocated: "Assignat",
        allocationDetails: "Detalls d'AssignaciÃ³",
        total: "TOTAL",
        totalGeneral: "TOTAL GENERAL",
        
        // WIP
        wipTitle: "ValoraciÃ³ WIP",
        wipSubtitle: "CÃ lcul de la valoraciÃ³ del Work in Process",
        baseConfig: "ConfiguraciÃ³ Base",
        valuationMethod: "MÃ¨tode de ValoraciÃ³",
        deptName: "Nom del Departament",
        periodCosts: "Costos del PerÃ­ode",
        materials: "Materials",
        conversionCosts: "Costos de ConversiÃ³ Indirectes",
        openingWIP: "WIP d'Obertura",
        unitsInWIP: "Unitats en WIP Inicial",
        completionPercent: "% de FinalitzaciÃ³ (CC%)",
        materialsCostWIP: "Cost Materials WIP",
        conversionCostWIP: "Cost ConversiÃ³ WIP",
        periodMovements: "Moviments del PerÃ­ode",
        unitsStarted: "Unitats Iniciades",
        unitsCompleted: "Unitats Completades",
        endingWIPCC: "CC% WIP Final",
        calculateWIP: "ðŸ§® Calcular ValoraciÃ³ WIP",
        wipResults: "Resultats WIP",
        physicalFlow: "Flux FÃ­sic",
        openingWIPLabel: "WIP d'Obertura",
        started: "Iniciades",
        completed: "Completades",
        startedCompleted: "Iniciades & Completades",
        endingWIP: "WIP Final",
        equivalentUnits: "Unitats Equivalents",
        costPerEU: "Cost per Unitat Equivalent",
        completingOpeningWIP: "Completant WIP d'Obertura",
        openingDM: "DM d'Obertura",
        openingCC: "CC d'Obertura",
        additionalCC: "CC Addicional per completar",
        totalOpeningWIP: "Total WIP d'Obertura",
        startedAndCompleted: "Iniciades i Completades",
        totalStartedCompleted: "Total Iniciades & Completades",
        endingWIPSection: "WIP Final",
        totalEndingWIP: "Total WIP Final",
        finishedGoods: "PRODUCTES ACABATS",
        units: "unitats",
        unit: "unitat"
    }
};

let currentLang = 'it';

function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('preferredLanguage', lang);
    updateAllTexts();
    
    // Update active language button
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-lang="${lang}"]`).classList.add('active');
    
    // Trigger custom event for dynamic content updates
    window.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang } }));
}

function t(key) {
    return translations[currentLang][key] || key;
}

function updateAllTexts() {
    // Update all elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = t(key);
    });
    
    // Update placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        el.placeholder = t(key);
    });
}

// Initialize language on load
document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('preferredLanguage') || 'it';
    setLanguage(savedLang);
});
